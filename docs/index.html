<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Bloomington Animal Care and Control Data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Bloomington Animal Care & Control Data - R Notebooks</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Documentation &amp; Processing</a>
</li>
<li>
  <a href="visual.html">Visualization Notebook</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Bloomington Animal Care and Control Data</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Bloomington Animal Care and Control data is available through <strong><a href="https://data.bloomington.in.gov/">BClear</a></strong>, a data portal for Bloomington, Indiana’s city government. The <strong><a href="https://bloomington.in.gov/animal-shelter">Animal Care and Control Division</a></strong> has prepared two data sets that the public may use to understand how the city handles animal welfare.</p>
<p>Documention and processing workflow for two Bloomington Animal Care and Control data sets are provided below. These data sets include the division’s historic <strong>Annual Statistics</strong> and <strong>Animal Cases Data</strong> representing the flow of animals in and out of the Bloomington Animal Shelter from the start of 2017 to present day.</p>
<p>This notebook was created for the <strong>BMG Hack’s - Let’s Get Visual - Civic Data Challenge</strong>. The notebook provides a description of each data set, and provides code for the data processing performed on these data that (hopefully) will facilitate analysis and visualization that can be updated, re-used, and shared with others!</p>
<div id="download-processed-data" class="section level3">
<h3>Download Processed Data</h3>
<p>Data processing outputs are collected in a ZIP file and available for download in the link below. Data is provided in CSV format.</p>
<div id="processed-animal-care-and-control-data---feb.-20-2020" class="section level4">
<h4><strong><a href="https://github.com/mginda/bmghack-animalcontrol/raw/master/data/bmg-acc-data.zip">Processed Animal Care and Control Data</a></strong> - Feb. 20, 2020</h4>
</div>
</div>
<div id="navigate-to" class="section level3">
<h3>Navigate to…</h3>
<ul>
<li><a href="#annual-stats">Annual Statistics Documentation</a></li>
<li><a href="#cases">Animal Case Data Documentation</a></li>
</ul>
</div>
</div>
<div id="data-documentation-and-processing-notes" class="section level1">
<h1>Data Documentation and Processing Notes</h1>
<div id="r-environment-set-up" class="section level2">
<h2>R Environment Set-Up</h2>
<p>Here we set up the R environment, and load in the R Packages that will be used in the notebook.</p>
<pre class="r"><code>#Clean up environment
rm(list=ls())
#Packages used in notebook
library(curl)        # Data downloads via URL
library(tidyr)       # Tidyverse data processing piping, string manipulation
library(readr)       # Data parsing
library(plyr)        # Combining and Splitting Data
library(dplyr)       # Data analysis and aggregations
library(lubridate)   # Dates
library(magrittr)    # Piping</code></pre>
<div id="loading-data-from-animal-care-and-control" class="section level3">
<h3>Loading Data from Animal Care and Control</h3>
<p>Data is loaded directly into R using a CURL function that uses <strong>BClear</strong> URLS to data downloads for the Animal Care and Control data. Data is provided a CSVs with headers.</p>
<pre class="r"><code>#Annual Statistics
annual &lt;- read.csv(curl(url=&quot;https://data.bloomington.in.gov/dataset/9a0fc126-0775-4952-96ff-76ece67ffbc7/resource/7a847ec2-31c6-48e3-b0bc-02af2fa94587/download/animal-care-and-control-data-set-2004-2019.csv&quot;), header=TRUE, stringsAsFactors = F)
#Intake and adoption records
intake &lt;- read.csv(curl(url=&quot;https://data.bloomington.in.gov/dataset/94d3f457-57b5-45be-bee0-a0106f59b7ed/resource/8854ce02-e8f5-44b9-b85f-17f002a7d023/download/animals.csv&quot;), header=TRUE, stringsAsFactors = F)</code></pre>
<p>Before analyzing and visualizing these data, the variables in the data set were reviewed to ensure that they have the correct data type in R, and to determine how variables relate to each other. The data processing routine documented below is used to clean-up and reshape the data to aid development and resuse of these data in a visual analytics workflow.</p>
</div>
</div>
<div id="annual-stats" class="section level2">
<h2>Annual Statistics Documentation</h2>
<div id="source-annual-statistics-2004-2019" class="section level4">
<h4><strong>Source: <a href="https://data.bloomington.in.gov/dataset/animal-care-and-control/resource/7a847ec2-31c6-48e3-b0bc-02af2fa94587">Annual Statistics (2004-2019)</a></strong></h4>
<p>These data represent high level annual statistics for the division, which includes revenue, budgets, staffing, counts of animal intakes and movements. These data is great for those interested in practicing implementing basic data visualizations using a tidy data set.</p>
<ul>
<li>Number of employees - <em>employees</em></li>
<li>Number of vehicles - <em>vehicles</em></li>
<li>Annual Budget - <em>budget</em> - $</li>
<li>Grants Recieved - <em>grants</em> - $</li>
<li>Revenue from Adoptions - <em>revenue</em> - $</li>
<li>Service Calls - <em>serviceCalls</em></li>
<li>Emergency Calls - <em>emergencyCalls</em></li>
<li>Number of Owner Surrended - <em>surrender</em></li>
<li>Number of Strays - <em>stray</em></li>
<li>Number of Impounded - <em>impound</em></li>
<li>Total Number of Intakes - <em>intake</em></li>
<li>Number of Transfer to other Shelters - <em>transfer</em></li>
<li>Number of Fosters - <em>foster</em></li>
<li>Number of Adoptions - <em>adopt</em></li>
<li>Number of Returnes - <em>return</em></li>
<li>Number of Euthinizations - <em>euthenize</em></li>
</ul>
</div>
<div id="data-structure" class="section level3">
<h3>Data Structure</h3>
<p>A review of the data structure reveals two issues with the Animial Care and Control Divisions’ Annual Statistics data set:</p>
<ol style="list-style-type: decimal">
<li>Variables use verbose names with have had punctuation added for spaces and text is captialized;</li>
<li>Monetary values are captured as character strings with symbols and empty spaces rather than providing providing a numeric values. We need to fix these two issues with our data.</li>
</ol>
<pre><code>## &#39;data.frame&#39;:    16 obs. of  3 variables:
##  $ Annual.Budget          : chr  &quot;$782,931.00 &quot; &quot;$760,206.00 &quot; &quot;$1,030,661.00 &quot; &quot;$1,062,946.00 &quot; ...
##  $ Grants.Received        : chr  &quot;$0.00 &quot; &quot;$18,925.00 &quot; &quot;$5,555.00 &quot; &quot;$0.00 &quot; ...
##  $ Annual.Adoption.Revenue: chr  &quot;$13,146.00 &quot; &quot;$112,649.00 &quot; &quot;$105,401.00 &quot; &quot;$100,170.00 &quot; ...</code></pre>
</div>
<div id="preparing-data" class="section level3">
<h3>Preparing Data</h3>
<pre class="r"><code>#Save original column name values
annual_cols &lt;- colnames(annual)
#Substitutes periods from original column names with spaces
annual_cols &lt;- gsub(&quot;\\.&quot;,&quot;\\ &quot;,annual_cols)
#Renames fields to shorter values
names(annual) &lt;- c(&quot;year&quot;,&quot;employees&quot;,&quot;vehicles&quot;,&quot;budget&quot;,&quot;surrender&quot;,&quot;stray&quot;,&quot;impound&quot;,
                   &quot;intake&quot;,&quot;adopt&quot;,&quot;return&quot;,&quot;euthanize&quot;,&quot;tranfer&quot;,&quot;foster&quot;,&quot;serviceCalls&quot;,
                   &quot;emergencyCalls&quot;,&quot;grants&quot;,&quot;revenue&quot;)
#Parse the budget, grants and revenue fields to create numeric values instead of character strings
annual$budget &lt;- parse_number(annual$budget, na=&quot;NA&quot;)
annual$grants &lt;- parse_number(annual$grants, na=&quot;NA&quot;)
annual$revenue &lt;- parse_number(annual$revenue, na=&quot;NA&quot;)</code></pre>
<p>Now we can get accurate descriptive data summaries for the 17 variables in the Annual Statistics observations for the Animal Control Division. Variables measured, include:</p>
</div>
<div id="summary-descriptive-statistics" class="section level3">
<h3>Summary Descriptive Statistics</h3>
<pre><code>##       year        employees        vehicles         budget       
##  Min.   :2004   Min.   :15.15   Min.   :3.000   Min.   : 760206  
##  1st Qu.:2008   1st Qu.:16.99   1st Qu.:3.000   1st Qu.:1115117  
##  Median :2012   Median :17.40   Median :3.000   Median :1173702  
##  Mean   :2012   Mean   :17.40   Mean   :3.062   Mean   :1194901  
##  3rd Qu.:2015   3rd Qu.:17.80   3rd Qu.:3.000   3rd Qu.:1318979  
##  Max.   :2019   Max.   :20.00   Max.   :4.000   Max.   :1567670  
##                                                                  
##    surrender        stray         impound        intake         adopt     
##  Min.   :1637   Min.   :1335   Min.   :446   Min.   :3598   Min.   :1737  
##  1st Qu.:1812   1st Qu.:1412   1st Qu.:480   1st Qu.:3835   1st Qu.:1886  
##  Median :1970   Median :2143   Median :491   Median :4065   Median :2104  
##  Mean   :1990   Mean   :2126   Mean   :513   Mean   :4321   Mean   :2106  
##  3rd Qu.:2149   3rd Qu.:2562   3rd Qu.:532   3rd Qu.:4815   3rd Qu.:2285  
##  Max.   :2361   Max.   :3257   Max.   :616   Max.   :5608   Max.   :2684  
##                                NA&#39;s   :11                                 
##      return        euthanize       tranfer          foster      
##  Min.   :452.0   Min.   : 224   Min.   : 62.0   Min.   : 380.0  
##  1st Qu.:522.0   1st Qu.: 541   1st Qu.:149.0   1st Qu.: 599.5  
##  Median :546.0   Median : 998   Median :209.0   Median : 712.0  
##  Mean   :538.9   Mean   :1095   Mean   :292.8   Mean   : 720.4  
##  3rd Qu.:558.8   3rd Qu.:1722   3rd Qu.:458.0   3rd Qu.: 780.0  
##  Max.   :615.0   Max.   :2277   Max.   :670.0   Max.   :1159.0  
##                                                 NA&#39;s   :1       
##   serviceCalls  emergencyCalls      grants         revenue      
##  Min.   :1440   Min.   : 97.0   Min.   :    0   Min.   : 13146  
##  1st Qu.:2206   1st Qu.:150.0   1st Qu.:    0   1st Qu.:100788  
##  Median :2510   Median :151.0   Median :    0   Median :106046  
##  Mean   :2353   Mean   :179.2   Mean   : 5676   Mean   : 99827  
##  3rd Qu.:2665   3rd Qu.:233.5   3rd Qu.: 8213   3rd Qu.:109428  
##  Max.   :2950   Max.   :290.0   Max.   :37498   Max.   :113070  
##  NA&#39;s   :1</code></pre>
</div>
<div id="example-annual-statistics-observations" class="section level3">
<h3>Example Annual Statistics Observations</h3>
<pre><code>##   year employees vehicles  budget surrender stray impound intake adopt
## 1 2004    15.150        3  782931      2351  3257      NA   5608  1896
## 2 2005    16.600        3  760206      2104  3038      NA   5142  1866
## 3 2006    16.600        3 1030661      2361  2800      NA   5161  1737
## 4 2007    17.230        3 1062946      2294  2519      NA   4813  1825
## 5 2008    17.725        3 1132507      2131  2690      NA   4821  1849
## 6 2009    17.975        3 1164248      2203  2316      NA   4591  1893
##   return euthanize tranfer foster serviceCalls emergencyCalls grants
## 1    558      2277     592     NA           NA            150      0
## 2    542      1724     670    380         1525            150  18925
## 3    554      1856     657    700         2900            150   5555
## 4    523      1753     539    800         2950            150      0
## 5    544      1721     431    600         2700            150  11215
## 6    452      1612     275    712         2515             97  37498
##    revenue
## 1  13146.0
## 2 112649.0
## 3 105401.0
## 4 100170.0
## 5 106627.0
## 6 112187.8</code></pre>
</div>
</div>
<div id="cases" class="section level2">
<h2>Animal Case Data Documenation</h2>
<div id="source-adoptions-2017-present" class="section level4">
<h4><strong>Source: <a href="https://data.bloomington.in.gov/dataset/adopted-animals/resource/8854ce02-e8f5-44b9-b85f-17f002a7d023">Adoptions (2017-Present)</a></strong></h4>
<p>The Animal Case data set represent animal case records maintained by the division. This is a much larger and complex data set compared to the annual statistics. The Bloomington Animal Shelter, which uses the <a href="https://www.sheltermanager.com/site/en_tour.html">Shelter Manager</a> database to manage its case load. The data provided by the city is a roll-up of multiple tables from the shelter database. Currently, there are over 12,000 intake records available to download.</p>
<p>The goal of data processing workflow presented below is to create different subsets that best represent the different types of interactions that an animal may experience in the shelter system. These sub-sets allow a user to create tailored analysis and visualizations. The data sets derived from the origianl data set include:</p>
<ol style="list-style-type: decimal">
<li><a href="#animals">Animal Identification</a></li>
<li><a href="#intakes">Intake Cases</a></li>
<li><a href="#moves">Animals on the Move (adoptions, fosters, transfers, etc.)</a></li>
<li><a href="#returns">Returned Animals</a></li>
<li><a href="#dead">Deceased Animals</a></li>
<li><a href="#log">Shelter Interaction Log</a></li>
<li><a href="#sup">Supplemental Animal Statistics</a></li>
</ol>
</div>
<div id="known-issues-and-limitations" class="section level3">
<h3>Known Issues and Limitations</h3>
<p>Working with the Animal Case Data set has provided me some insights on issues and limitations present in these data. Issues relate to the quality of data observations captured by the shelter, while limitations indicate areas where there are gaps in what is knowable based on the data provided.</p>
<div id="issues-found-in-data" class="section level4">
<h4>Issues found in data</h4>
<ul>
<li>Animal ages are estimates of the intake specialists based on examination of the animal and/or from information provided upon intake &amp; return.</li>
<li>Animal breed information may be the best guess of the intake specialists.</li>
<li>Reasons for animal intake and returns are subjective and limited to one category per animal. Some assignments may be defaults for particular cases where multiple reasons apply.</li>
<li>Transfers to other shelters exist within intake and movement data sets; however, the flag field <em>istransfer</em> is not used in these interactions.</li>
<li>The calculation of duration in the shelter system is subjective. I consider time in foster care to be time an animal is still in the system, but outside of the shelter.</li>
<li>All animals are assigned a reason/cause for being killed; however, this is likely a default field required at intake, even if an animal has not been killed. These values are excluded from the <em>dead</em> data set.</li>
<li>Some animals taken or returned are logged as <em>dead on arrival</em>/<em>DOA</em>, but also have a duration time calculation.</li>
<li>Flags used in the <em>dead</em> data set have unclear combinations (e.g. an animal died off shelter and is DOA).</li>
</ul>
</div>
<div id="limitations-with-data" class="section level4">
<h4>Limitations with data</h4>
<ul>
<li>There is not data on who brought in, adopted, reclaimed, or fostered an animal.</li>
<li>Transfers to other shelters exist within intake and movement data sets; however, where an animal comes or goes is not provided here.</li>
<li>The outcome of an animal transferred to another shelter system is unknown.</li>
<li>Some adopted animals may have been returned to another shelter, or given to a family or friend against shelter adoption agreements.</li>
<li>Animal build/size is captured but not provided here.</li>
<li>Animal fertility status is not capture in these data.</li>
<li>Animal special needs and behavioral issues may not be fully captured.</li>
<li>Animal sponsorship for adoption by staff and volunteers is not captured in the data.</li>
<li>The shelter runs multiple adoption focused events; however, these events are not provided as a data set to supplement case records.</li>
</ul>
</div>
</div>
<div id="processing-workflow" class="section level3">
<h3>Processing Workflow</h3>
<div id="data-structure-1" class="section level4">
<h4>Data Structure</h4>
<p>There are 12404 observations across 23 variables in this data set. The data structure provides a description of the variables below.</p>
<p>Reading the variable names shows that the data set uses common naming convention in variable names to indicate relationships. Examples of variable relationships include fields starting with: <em>intake</em>, <em>movement</em>, <em>return</em>, and <em>deceased</em>. This suggests that there are a minimum of four tables combined in this data set.</p>
<p>Data tables are likely joined in the shelter’s database by the <em>id</em> acting as the primary key This field will present in all derived subsets to help join related data frames.</p>
<pre><code>## &#39;data.frame&#39;:    12404 obs. of  23 variables:
##  $ id              : int  15801 15932 28859 30812 30812 31469 31469 40705 40706 46238 ...
##  $ intakedate      : chr  &quot;2009-11-28 00:00:00&quot; &quot;2009-12-08 00:00:00&quot; &quot;2012-08-10 00:00:00&quot; &quot;2013-01-11 00:00:00&quot; ...
##  $ intakereason    : chr  &quot;Moving&quot; &quot;Moving&quot; &quot;Abandoned&quot; &quot;Abandoned&quot; ...
##  $ istransfer      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ sheltercode     : chr  &quot;C09115463&quot; &quot;D09125594&quot; &quot;D12082309&quot; &quot;C1301091&quot; ...
##  $ identichipnumber: chr  &quot;0A115D7358&quot; &quot;0A11675477&quot; &quot;0A13253C7B&quot; &quot;0A13403D4D&quot; ...
##  $ animalname      : chr  &quot;Jadzia&quot; &quot;Gonzo&quot; &quot;Maggie&quot; &quot;Pretty Girl&quot; ...
##  $ breedname       : chr  &quot;Domestic Short Hair&quot; &quot;German Shepherd Dog/Mix&quot; &quot;Shep Mix/Siberian Husky&quot; &quot;Domestic Short Hair&quot; ...
##  $ basecolour      : chr  &quot;Tortie&quot; &quot;Tan&quot; &quot;Various&quot; &quot;Dilute tortoiseshell&quot; ...
##  $ speciesname     : chr  &quot;Cat&quot; &quot;Dog&quot; &quot;Dog&quot; &quot;Cat&quot; ...
##  $ animalage       : chr  &quot;9 years 2 months.&quot; &quot;10 years 0 months.&quot; &quot;6 years 8 months.&quot; &quot;8 years 11 months.&quot; ...
##  $ sexname         : chr  &quot;Female&quot; &quot;Male&quot; &quot;Female&quot; &quot;Female&quot; ...
##  $ location        : chr  &quot;Adoptable Cat Glass Colony&quot; &quot;Adoptable Dogs&quot; &quot;Adoptable Dogs&quot; &quot;Stray Cats&quot; ...
##  $ movementdate    : chr  &quot;2017-05-13 00:00:00&quot; &quot;2017-04-24 00:00:00&quot; &quot;2017-04-15 00:00:00&quot; &quot;2017-04-18 00:00:00&quot; ...
##  $ movementtype    : chr  &quot;Adoption&quot; &quot;Adoption&quot; &quot;Adoption&quot; &quot;Foster&quot; ...
##  $ istrial         : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ returndate      : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;2018-05-29 00:00:00&quot; ...
##  $ returnedreason  : chr  &quot;Stray&quot; &quot;Stray&quot; &quot;Stray&quot; &quot;Stray&quot; ...
##  $ deceaseddate    : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ deceasedreason  : chr  &quot;Died in care&quot; &quot;Died in care&quot; &quot;Died in care&quot; &quot;Died in care&quot; ...
##  $ diedoffshelter  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ puttosleep      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ isdoa           : int  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
<div id="assigning-data-types" class="section level4">
<h4>Assigning Data Types</h4>
<p>Before subsetting the animal case data set into cleaner subsets, variables are processed to ensure that they have the proper data types assigned. The case data requires transforming fields into factor/categorical variables, and to dates. Note, <em>animalage</em> is ignored, but it is processed later in the <em>Animal Idenfification</em> data set.</p>
<pre class="r"><code>#Copy intake to new data.frame data 
data &lt;- intake
#List of factor variables column names
intake_fac &lt;- colnames(data[,c(1,3,5:10,12,13,15,18,20)])
#Converts variables from character strings to factors
for(i in 1:length(intake_fac)){
  data[,intake_fac[i]] &lt;- data[,intake_fac[i]] %&gt;% as.factor()
}
#List of date variable column names
intake_date &lt;- colnames(data[,c(2,14,17,19)])
#Convert variables from character strings to dates
for(i in 1:length(intake_date)){
  if(length(data[data[,intake_date[i]]==&quot;&quot;,intake_date[i]])&gt;0){
    data[data[,intake_date[i]]==&quot;&quot;,intake_date[i]] &lt;- NA
  }
  data[,intake_date[i]] &lt;- data[,intake_date[i]] %&gt;% as.Date()
}
rm(i, intake_date, intake_fac)</code></pre>
</div>
<div id="animals" class="section level4">
<h4>1. Animal Identification</h4>
<p>Animals taken in by Animal Care and Control Division are described across a variety of features, including multiple identifiers, a basic description of the animal, and the location within the shelter. The variables included in this data set are:</p>
<ul>
<li>Animal Case identifier - <em>id</em> - a numeric unique identifier with 8635 unique values.
<ul>
<li>This field acts as the primary key that will connect data sets together</li>
</ul></li>
<li>Shelter Code - <em>sheltercode</em> - a numeric unique identifier with 8635values.
<ul>
<li>The difference between unique identifers and total number of observations in the data set (3769) indicates that there may be multiple intake records for a given animal in the data set.</li>
<li>The letter code starting each id indicates species class (e.g. C09115463 for cat).</li>
</ul></li>
<li>Animal identity chip - <em>identichipnumber</em> - factor variable with 6637 unique values
<ul>
<li>Not all animals have chip identifiers.</li>
</ul></li>
<li>Animal name - <em>animalname</em> - factor variable with 4937 unique values
<ul>
<li>We’ve got some common names!</li>
</ul></li>
<li>Breed - <em>breedname</em> - factor variable with 873 unique values</li>
<li>Animal coloration - <em>basecolour</em> - factor variable with 79 unique values</li>
<li>Species - <em>speciesname</em> - factor variable with 27 unique values.
<ul>
<li>There are some surprises here</li>
</ul></li>
<li>Animal age (estimated) - <em>animalage</em> - string with values such as 9 years 2 months.
<ul>
<li>This field is valuable, but requires processing to extract a usable estimate of age (years or months)</li>
</ul></li>
<li>Animal sex - <em>sex</em> - factor variable with 3 unique values.</li>
</ul>
<pre class="r"><code>#Creates demographic data set of unique animals with intake cases
animals &lt;- data[,c(&quot;id&quot;,&quot;sheltercode&quot;,&quot;identichipnumber&quot;,&quot;animalname&quot;,&quot;animalage&quot;,&quot;sexname&quot;,&quot;speciesname&quot;,&quot;breedname&quot;,&quot;basecolour&quot;)] %&gt;% unique()
#Processes animal age to
tmp &lt;- as.data.frame(as.character(animals$animalage),stringsAsFactors = F)
names(tmp) &lt;- &quot;animalage&quot;
tmp$intakeage &lt;- as.numeric(0)
for(i in 1:nrow(tmp)){
  #Converts string to a dataframe by way of 2 col matrice
  d &lt;- stringr::str_split(tmp[i,]$animalage,&quot;\\ &quot;) %&gt;% unlist() 
  if(length(d)==2){
    d &lt;- d %&gt;% matrix(ncol=2) %&gt;% data.frame()
  } else {
    d &lt;- d %&gt;% matrix(ncol=2) %&gt;% t() %&gt;% data.frame()
  }
  d$X1 &lt;- as.character(d$X1) %&gt;% as.numeric()
  # Years to months
  if(length(d[d$X2==&quot;years&quot; | d$X2==&quot;year&quot;,]$X2)&gt;0){
    d[d$X2==&quot;years&quot; | d$X2==&quot;year&quot;,]$X1 &lt;- d[d$X2==&quot;years&quot; | d$X2==&quot;year&quot;,]$X1 * 12
  }
  #Weeks to months
  if(length(d[d$X2==&quot;weeks.&quot; | d$X2==&quot;week.&quot;,]$X2)&gt;0){
    d[d$X2==&quot;weeks.&quot; | d$X2==&quot;week.&quot;,]$X1 &lt;- d[d$X2==&quot;weeks.&quot; | d$X2==&quot;week.&quot;,]$X1 * (1/4.5)
  }
  #Days to months
  if(length(d[d$X2==&quot;days.&quot; | d$X2==&quot;day.&quot;,]$X2)&gt;0){
    d[d$X2==&quot;weeks.&quot; | d$X2==&quot;week.&quot;,]$X1 &lt;- d[d$X2==&quot;weeks.&quot; | d$X2==&quot;week.&quot;,]$X1 * (1/30)
  }
  tmp[i,]$intakeage &lt;- sum(d$X1)
}
#Creates new column in animals data.frame
animals$intakeage &lt;- tmp$intakeage
#Removes objects
rm(i,d,tmp)
#Summarize intake cases
summary(animals)</code></pre>
<pre><code>##        id         sheltercode          identichipnumber   animalname  
##  15801  :   1   B1704028:   1                  :1952    Luna   :  40  
##  15932  :   1   B1704061:   1   0A10785A1E     :   4    Buddy  :  34  
##  28859  :   1   B1704124:   1   981020009920224:   3    Lucy   :  34  
##  30812  :   1   B1705201:   1   991001000578554:   3    Daisy  :  31  
##  31469  :   1   B1705202:   1   021027788      :   2    Bella  :  29  
##  40705  :   1   B1705264:   1   0A10592A42     :   2    Max    :  27  
##  (Other):8629   (Other) :8629   (Other)        :6669    (Other):8440  
##   animalage            sexname           speciesname  
##  Length:8635        Female :4121   Cat         :4662  
##  Class :character   Male   :4269   Dog         :3327  
##  Mode  :character   Unknown: 245   House Rabbit: 209  
##                                    Rat         : 124  
##                                    Guinea Pig  : 110  
##                                    Bird        :  50  
##                                    (Other)     : 153  
##                 breedname              basecolour     intakeage      
##  Domestic Short Hair :3780   Black          :1258   Min.   :   0.00  
##  Domestic Medium Hair: 383   Black and White: 772   1st Qu.:  10.00  
##  Domestic Long Hair  : 288   Black and Brown: 540   Median :  20.00  
##  Bully Breed Mix     : 250   Grey           : 482   Mean   :  41.25  
##  Labrador Retriever  : 148   Orange         : 414   3rd Qu.:  46.00  
##  Beagle              : 131   Grey and White : 302   Max.   :1209.00  
##  (Other)             :3655   (Other)        :4867</code></pre>
</div>
</div>
<div id="intakes" class="section level3">
<h3>2. Intake Cases</h3>
<p>Intake Case data include any variable that relates to when an animal first interacts with the Animal Care and Control shelter system. Intake related variables included in this data set are:</p>
<ul>
<li>Intake identifier - <em>id</em> - a numeric unique identifier with 8635 unique values.
<ul>
<li>The number of unqiue ids and unique shelter codes are identical. And, as with <em>sheltercodes</em> variable above, the count of unique <em>id</em> values is less than total intake records provided by the division. This suggests unique identifier is linked to the animal’s intial intake.</li>
</ul></li>
<li>Intake date - <em>intakedate</em> - changed to -&gt; <em>date</em> - a date field (YYYY-MM-DD) ranging from 2009-11-28 to 2020-02-22.
<ul>
<li>Intake data sets may require more examination and potentiall filtering to removing intakes prior 2017, the first year when records begin were first collected in full.</li>
<li>Needs processing to as.Date() type.</li>
</ul></li>
<li>Intake reason - <em>intakereason</em> - changed to -&gt; <em>interaction</em> - a factor variable with 27 unique values.</li>
<li>Location within shelter - <em>location</em> - a factor variable with 39 unique values.</li>
<li>Interation type - <em>type</em> - a new field that indicates the type of interaction with the shelter</li>
</ul>
<pre class="r"><code>#Creates demographic data set of unique animals with intake cases
intakes &lt;- data[,c(&quot;id&quot;,&quot;intakedate&quot;,&quot;intakereason&quot;,&quot;location&quot;)] %&gt;% unique()
#Update field names
names(intakes)[2:3] &lt;- c(&quot;date&quot;,&quot;interaction&quot;)
#Updates blank level with None
levels(intakes$interaction)[levels(intakes$interaction)==&quot;&quot;] &lt;- &quot;No Reason&quot;
#Interaction type
intakes$type &lt;- &quot;intake&quot;
#Summarize intake cases
summary(intakes)</code></pre>
<pre><code>##        id            date           
##  15801  :   1   Min.   :2009-11-28  
##  15932  :   1   1st Qu.:2017-11-02  
##  28859  :   1   Median :2018-08-24  
##  30812  :   1   Mean   :2018-08-19  
##  31469  :   1   3rd Qu.:2019-06-03  
##  40705  :   1   Max.   :2020-02-22  
##  (Other):8629                       
##                             interaction  
##  Stray                            :4105  
##  Incompatible with owner lifestyle:1165  
##  Litter relinquishment            : 757  
##  Moving                           : 445  
##  Unsuitable Accommodation         : 334  
##  Unable to Afford                 : 316  
##  (Other)                          :1513  
##                        location        type          
##  Adoptable Dogs            :1679   Length:8635       
##  Adoptable Cat Kennels     : 733   Class :character  
##  Lobby                     : 562   Mode  :character  
##  Adoptable window colony   : 489                     
##  Adoptable Cat Glass Colony: 471                     
##  Adoptable Cat Big Colony  : 445                     
##  (Other)                   :4256</code></pre>
</div>
<div id="moves" class="section level3">
<h3>3. Animals on the Move</h3>
<p>After the initial intake, the goal of the shelter is to move animals out of the Animal Care and Control system. Some example movements include when an animal being fostered or adopted. Variables related to animal movements, include:</p>
<ul>
<li>Animal Case identifier - <em>id</em> - a numeric unique identifier with 8635 unique values.</li>
<li>Movement date - <em>movementdate</em> - changed to -&gt; <em>date</em> - a date field (YYYY-MM-DD) ranging from 2013-03-30 to 2020-02-23.
<ul>
<li>Needs processing to as.Date() data types.</li>
</ul></li>
<li>Movement type - <em>movementtype</em> - changed to -&gt; <em>interaction</em> - a factor variable with 7 unique values.
<ul>
<li>This field indicates what happens to an animal after the intake is logged..</li>
</ul></li>
<li>Trial status - <em>istrial</em> - a binary (1/0) variable indicating if the animal is a trial adoption.
<ul>
<li>All values are currently <em>0</em>, meaning the field has no value and should be removed.</li>
</ul></li>
<li>Transfer status - <em>istransfer</em> - a binary (1/0) variable indicating if the animal is transferred from the system.</li>
<li>Interation type - <em>type</em> - a new field that indicates the type of interaction with the shelter system.</li>
</ul>
<pre class="r"><code>#Creates demographic data set of unique animals with intake cases
move &lt;- data[,c(&quot;id&quot;,&quot;movementdate&quot;,&quot;movementtype&quot;)] %&gt;% 
  unique() %&gt;% 
  arrange(id)
names(move)[2:3] &lt;- c(&quot;date&quot;,&quot;interaction&quot;)
move$type &lt;- &quot;move&quot;
#Summarize movements
summary(move)</code></pre>
<pre><code>##        id             date                      interaction  
##  58510  :   11   Min.   :2013-03-30   Adoption        :7163  
##  60702  :   11   1st Qu.:2017-12-12   Escaped         :   4  
##  55456  :   10   Median :2018-09-27   Foster          :2954  
##  61384  :   10   Mean   :2018-09-21   Reclaimed       :1655  
##  58410  :    7   3rd Qu.:2019-07-05   Released To Wild:   9  
##  47575  :    6   Max.   :2020-02-23   Stolen          :   8  
##  (Other):12340                        Transfer        : 602  
##      type          
##  Length:12395      
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## </code></pre>
</div>
<div id="returns" class="section level3">
<h3>4. Returned Animals</h3>
<p>Occasionally, an animal returns to the shelter. However, rather than creating a new intake case, the animal’s interaction is logged as a return. Variables related to returned to the shelter system describe cause and date for a return to Animal Care and Control. The variables included in this data set are:</p>
<ul>
<li>Animal Case identifier - <em>id</em> - a numeric unique identifier with 8635 unique values.</li>
<li>Return date - <em>returndate</em> - changed to -&gt; <em>date</em> - a date field (YYYY-MM-DD) ranging from 2017-04-01 to 2020-02-23.
<ul>
<li>Not all intake records include a return date, indicating the animal has not been returned to the system.</li>
<li>Needs processing to as.Date() data types.</li>
</ul></li>
<li>Return reason - <em>returnedreason</em> - changed to -&gt; <em>interaction</em> - a factor variable with 25 unique values.
<ul>
<li>Some interesting unique values include: Stray, Incompatible with owner lifestyle, Rabies Monitoring.</li>
<li>This variable may be an interesting feature to explore reasons based on animal type and demographics. This may be useful for a predictive model at intake.</li>
</ul></li>
<li>Interation type - <em>type</em> - a new field that indicates the type of interaction with the shelter system.</li>
</ul>
<pre class="r"><code>#Creates demographic data set of unique animals with intake cases
return &lt;- data[,c(&quot;id&quot;,&quot;returndate&quot;,&quot;movementdate&quot;,&quot;returnedreason&quot;)] %&gt;%
  unique() %&gt;% 
  arrange(id)
return &lt;- return[!is.na(return$returndate),]
#Update field names
names(return)[c(2,4)] &lt;- c(&quot;date&quot;,&quot;interaction&quot;)
#Add interaction type
return$type &lt;- &quot;return&quot;
#Time to return
return$duration &lt;- difftime(return$date,return$date, unit=&quot;day&quot;)
#Summarize intake cases
summary(return)</code></pre>
<pre><code>##        id            date             movementdate       
##  58510  :  10   Min.   :2017-04-01   Min.   :2013-03-30  
##  60702  :  10   1st Qu.:2018-01-28   1st Qu.:2017-11-14  
##  61384  :  10   Median :2018-11-09   Median :2018-08-29  
##  55456  :   9   Mean   :2018-10-23   Mean   :2018-08-28  
##  58410  :   6   3rd Qu.:2019-07-30   3rd Qu.:2019-06-11  
##  47575  :   5   Max.   :2020-02-23   Max.   :2020-02-21  
##  (Other):3966                                            
##                             interaction       type          
##  Stray                            :3147   Length:4016       
##  Incompatible with owner lifestyle: 364   Class :character  
##  Return Adopt - Behavior          :  71   Mode  :character  
##  Return adopt - lifestyle issue   :  55                     
##  Moving                           :  53                     
##  Incompatible with other pets     :  38                     
##  (Other)                          : 288                     
##    duration       
##  Length:4016      
##  Class :difftime  
##  Mode  :numeric   
##                   
##                   
##                   
## </code></pre>
</div>
<div id="dead" class="section level3">
<h3>5. Deceased Animals</h3>
<p>Sometimes animals taken in or returned to the shelter that cannot be released. In these cases, the Animal Care and Control Division will euthanize an animal, or in rare cases, document a death that takes place at intake. The variables that describe data related to animal that have died while managed by Animal Care and Control included in this data set are:</p>
<ul>
<li>Animal Case identifier - <em>id</em> - a numeric unique identifier with 8635 unique values.</li>
<li>Deceased date - <em>deceaseddate</em> - changed to -&gt; <em>date</em> - a date field (YYYY-MM-DD) ranging from 2017-04-02 to 2020-02-20.
<ul>
<li>Not all intake records include a deceased date, indicating the animal is alive!</li>
<li>Needs processing to as.Date() data types.</li>
</ul></li>
<li>Deceased reason - <em>deceasedreason</em> - changed to -&gt; <em>interaction</em> - a factor variable with 14 unique values.
<ul>
<li>Some interesting unique values include: Died in care, UU - untreatable, unmanageable health, Healthy.</li>
<li>This variable may be an interesting feature to explore reasons based on animal type and demographics. This may be useful for a predictive model at intake.</li>
<li>All animals have a deceased reason even if they are not dead.</li>
</ul></li>
<li>Animal died off selter - <em>diedoffshelter</em> - a binary (1/0) variable indicating if the animal is died outside of the shelter.</li>
<li>Euthanize flag - <em>puttosleep</em> - a binary (1/0) variable indicating if the animal is euthanized from the system.</li>
<li>Dead on arrival flag - <em>isdoa</em> - a binary (1/0) variable indicating if the animal is died when they arrived at the shelter.</li>
<li>Interation type - <em>type</em> - a new field that indicates the type of interaction with the shelter system.</li>
</ul>
<pre class="r"><code>#Creates demographic data set of unique animals with intake cases
dead &lt;- data[,c(&quot;id&quot;,&quot;deceaseddate&quot;,&quot;deceasedreason&quot;,
                &quot;diedoffshelter&quot;,&quot;puttosleep&quot;,&quot;isdoa&quot;)] %&gt;% unique()
dead &lt;- dead[!is.na(dead$deceaseddate),]
#Update field names
names(dead)[2:3] &lt;- c(&quot;date&quot;,&quot;interaction&quot;)
#Adds interaction type
dead$type &lt;- &quot;dead&quot;
#Summarize intake cases
summary(dead)</code></pre>
<pre><code>##        id           date           
##  46437  :  1   Min.   :2017-04-02  
##  47360  :  1   1st Qu.:2017-12-08  
##  47742  :  1   Median :2018-09-03  
##  55371  :  1   Mean   :2018-09-01  
##  55396  :  1   3rd Qu.:2019-06-02  
##  55397  :  1   Max.   :2020-02-20  
##  (Other):276                       
##                                 interaction diedoffshelter  
##  Died in care                         :96   Min.   :0.0000  
##  UU - untreatable, unmanageable health:72   1st Qu.:0.0000  
##  Owner Requested                      :18   Median :0.0000  
##  Dead On Arrival                      :16   Mean   :0.0922  
##  Biting                               :15   3rd Qu.:0.0000  
##  UU-untreatable, unmanageable Behavior:13   Max.   :1.0000  
##  (Other)                              :52                   
##    puttosleep         isdoa             type          
##  Min.   :0.0000   Min.   :0.00000   Length:282        
##  1st Qu.:0.0000   1st Qu.:0.00000   Class :character  
##  Median :1.0000   Median :0.00000   Mode  :character  
##  Mean   :0.5461   Mean   :0.07092                     
##  3rd Qu.:1.0000   3rd Qu.:0.00000                     
##  Max.   :1.0000   Max.   :1.00000                     
## </code></pre>
</div>
<div id="log" class="section level3">
<h3>6. Shelter Interaction Log</h3>
<p>The Shelter Interaction Log provides a time series data set provides another data structure that may be relevant for a variety of visual analytic and modeling workflows. This data set captures the intake and outcomes data for each case managed by the shelter as a list. The list is ordered by the <em>Case ID</em> and <em>Date</em> of an interactions with the shelter system. This data may be joined to the animal descriptive data to help subset or filter the interaction logs.</p>
<ul>
<li>Animal Case identifier - <em>id</em> - a numeric unique identifier with 8635 unique values.</li>
<li>Interaction - <em>interaction</em> - a factor variable that describes the interaction with the shelter system. These categories have duplicate and similar values that are updated to reduce the quantity of qualitiative values.</li>
<li>Interation type - <em>type</em> - a factor variable that indicates the type of interaction with the shelter system (e.g intake, movement, return, dead).</li>
<li>Interaction date - <em>date</em> - a date field (YYYY-MM-DD) for an interaction with the shelter system.</li>
<li>Interaction date - <em>date_end</em> - a date field (YYYY-MM-DD) for when an interaction with the shelter system ends.</li>
<li>Time Interval - <em>time_int</em> - an interval field indicating period of time when an interaction occured.</li>
<li>Duration - <em>duration</em> - Measure of time between an interaction with the shelter system, measured in days.</li>
</ul>
<pre class="r"><code>#Creating shelter interaction dataframe
interact &lt;- rbind(intakes[,c(&quot;id&quot;,&quot;date&quot;,&quot;interaction&quot;,&quot;type&quot;)],
                    move[,c(&quot;id&quot;,&quot;date&quot;,&quot;interaction&quot;,&quot;type&quot;)],
                    return[,c(&quot;id&quot;,&quot;date&quot;,&quot;interaction&quot;,&quot;type&quot;)],
                    dead[,c(&quot;id&quot;,&quot;date&quot;,&quot;interaction&quot;,&quot;type&quot;)]) %&gt;% 
                arrange(id,date)

#Intraction categories updated
tmp &lt;- interact$interaction %&gt;% as.character() 
#change interaction to... Behaviors 
tmp[tmp %in% c(&quot;Return Adopt - Behavior&quot;,&quot;Temperament/Behavior&quot;)] &lt;- &quot;Behavior&quot;
#change interaction to... Dead on arrival
tmp[tmp %in% c(&quot;DOA&quot;,&quot;Cremation&quot;)] &lt;- &quot;Dead On Arrival&quot;
#change interaction to... UU-untreatable, unmanageable Behavior
tmp[tmp == c(&quot;UU-untreatable, unmanageable Behavior&quot;)] &lt;- &quot;UU - untreatable, unmanageable Behavior&quot;
#change interaction to animal health
tmp[tmp %in% c(&quot;Return Adopt - Animal Health&quot;,&quot;Sick/Injured&quot;,&quot;Medical&quot;)] &lt;- &quot;Animal Health&quot;
#change interaction to owner deceased
tmp[tmp %in% c(&quot;Owner Died&quot;)] &lt;- &quot;Owner Deceased&quot;
#change interaction to... Owner requested
tmp[tmp %in% c(&quot;Owner requested Euthanasia&quot;)] &lt;- &quot;Owner requested&quot;
#change interaction to... Incompatible with owner lifestyle
tmp[tmp %in% c(&quot;Return adopt - lifestyle issue&quot;)] &lt;- &quot;Incompatible with owner lifestyle&quot;
tmp &lt;- as.factor(tmp)
#Add cleaned interaction data to data table
interact$interaction &lt;- tmp

#Loop calculates duration between shelter interaction for each animal&#39;s case
interact$date_end &lt;- NA
for(i in 1:length(unique(intakes$id))){
  tmp &lt;- interact[interact$id==intakes[i,]$id,c(&quot;id&quot;,&quot;type&quot;,&quot;date&quot;,&quot;date_end&quot;)]
  if(nrow(tmp)&gt;1){
        tmp[1:nrow(tmp)-1,]$date_end &lt;-  tmp[2:nrow(tmp),]$date
  }
  #Introduction of the NA in the date_end field are treated
  if(tmp[is.na(tmp$date_end),]$type==&quot;dead&quot;){
    #In cases where the type of interaction is a death, the NA date_end field is the same       the date field
    tmp[is.na(tmp$date_end),]$date_end &lt;- tmp[is.na(tmp$date_end),]$date
  } else {
    #In cases where the type of interaction is an intake, return, or move, date_end is the      current system date
    tmp[is.na(tmp$date_end),]$date_end &lt;- Sys.Date()
  }
  #Adds back tmp back to 
  interact[interact$id==intakes[i,]$id,c(&quot;date_end&quot;)] &lt;- tmp[,c(&quot;date_end&quot;)]
  }
#Clean environment
rm(tmp,i)

#Checks date_end for DOA on return
interact[interact$type==&quot;return&quot; &amp; interact$interaction==&quot;Dead On Arrival&quot;,]$date_end &lt;-
  interact[interact$type==&quot;return&quot; &amp; interact$interaction==&quot;Dead On Arrival&quot;,]$date

#Format values for date_end field
interact$date_end &lt;-as.Date(interact$date_end, origin=lubridate::origin,
                            format=&quot;%Y-%m-%d&quot;)
#Create time interval that interaction takes place
interact$time_int &lt;- interval(interact$date,interact$date_end)
#Calculate difference in time (days) of interval
interact$duration &lt;- difftime(interact$date_end,interact$date,unit=&quot;days&quot;)

#Transforms type into a factor variables
interact &lt;- interact[,c(1,3,4,2,5,6,7)]

#Summary of data
summary(interact)</code></pre>
<pre><code>##        id                                   interaction  
##  58510  :   22   Stray                            :7252  
##  60702  :   22   Adoption                         :7163  
##  61384  :   22   Foster                           :2954  
##  55456  :   20   Reclaimed                        :1655  
##  58410  :   14   Incompatible with owner lifestyle:1585  
##  47575  :   12   Litter relinquishment            : 757  
##  (Other):25216   (Other)                          :3962  
##      type                date               date_end         
##  Length:25328       Min.   :2009-11-28   Min.   :2013-03-30  
##  Class :character   1st Qu.:2017-12-05   1st Qu.:2018-06-13  
##  Mode  :character   Median :2018-09-18   Median :2019-07-06  
##                     Mean   :2018-09-15   Mean   :2019-03-17  
##                     3rd Qu.:2019-06-28   3rd Qu.:2020-02-24  
##                     Max.   :2020-02-23   Max.   :2020-02-24  
##                                                              
##               time_int            duration       
##  Intervals        :25328        Length:25328     
##  Earliest endpoint:2009-11-28   Class :difftime  
##  Latest endpoint  :2020-02-24   Mode  :numeric   
##  Time zone        :UTC                           
##                                                  
##                                                  
## </code></pre>
</div>
<div id="sup" class="section level3">
<h3>7. Supplemental Statistic for Animals</h3>
<p>Supplemental statistics for animals provide additional measurements that describe an animal’s time and interaction in the shelter. These variables were calculated from the <strong>Shelter Interaction Log</strong>. The list of supplemental statistical measured are described below. The data manipulation scripts to calculate supplemental statistics are documented in the preceeding sections.</p>
<ul>
<li>Number of Interactions with Shelter - <em>interactions</em> - this numeric value indicates the number of interactions that an animal has with the shelter.</li>
<li>Total time in shelter system - <em>timeinsys</em> - this numeric value representing the number of days that an animal is in the Animal Care and Control Division Shelter system.</li>
<li>Transfer In - <em>transfer_in</em> - a binary flag field indicating is an animal transfered into the shelter.</li>
<li>Transfer Out - <em>transfer_out</em> - a binary flag field indicating is an animal transfered out of the shelter.</li>
<li>Adopted - <em>adopt</em> &amp; <em>adopt_ct</em> - a binary flag field and count field indicating animal was adopted.</li>
<li>Fostered - <em>foster</em> &amp; <em>foster_ct</em> - a binary flag field and count field indicating animal was fostered.</li>
<li>Reclaimed - <em>reclaim</em> &amp; <em>reclaim_ct</em> - a binary flag field and count field indicating animal was reclaimed by an owner.</li>
<li>Returned - <em>return</em> &amp; <em>return_ct</em> - a binary flag field and count field indicating animal was returned to the shelter.</li>
<li>Death Logged by Shelter - <em>dead</em> - a binary flag field and count field indicating animal has died by shelter staff.</li>
<li>Shelter Intake Date - <em>intakedate</em> - date an animal was first taken in by the shelter.</li>
</ul>
<div id="supplemental-statistics-data-frame" class="section level4">
<h4>Supplemental Statistics Data Frame</h4>
<p>A copy of the <strong>Animal Idenification</strong> data set is copied into a new data frame.</p>
<pre class="r"><code>#New data frame of supplemental stats
animals_s &lt;- animals</code></pre>
</div>
<div id="number-of-interactions-with-shelter" class="section level4">
<h4>Number of Interactions with Shelter</h4>
<p>The <strong>Number of Interactions with Shelter</strong> uses the <strong>Shelter Interaction Log</strong> data. First, the <em>id</em> and <em>interaction</em> variables selected from the shelter’s interaction log (<em>interact</em>), then aggregated by the <em>group_by()</em> funtion on an animal’s identifier. Last, the the number interactions is counted using the <em>summarise()</em> and <em>n()</em> functions.</p>
<pre class="r"><code>#Total Shelter Interactions (Intake+Returns+Movements+Deaths)
tmp &lt;- interact %&gt;% 
          select(id,interaction) %&gt;% 
          group_by(id) %&gt;% 
          summarise(interactions = n()) 
animals_s &lt;- join(animals_s,tmp,by=&quot;id&quot;)</code></pre>
</div>
<div id="time-in-the-shelter-system" class="section level4">
<h4>Time in the Shelter System</h4>
<p><strong>Time in the Shelter System</strong> value represents the sum total duration in days that an animal is in the shelter or being fostered. Periods of time that are apart of this calculation include time from intake to a move out of the system (e.g. time to adoption, released to wilderness, or time until reclaimed by an owner.) Periods of time an animal moves out of the system, but later returns (e.g. adopted, reclaimed by owner, escaped, or stolen but returned to the shelter) are excluded from the calculations.</p>
<p>For the calculation, the <strong>Shelter Interaction Log</strong> is filtered to remove duration measurements with <em>NA</em> values are removed (e.g typically, last interaction with the shelter, such as when an animal has been adopted or when an animal is put down.)), and to remove a set of movement interactions with duration values associated with time outside of the shelter’s system (e.g. when an animal isn’t fostered). Next, the <em>id</em> and <em>duration</em> fields are selected, and aggregated by the <em>group_by()</em> funtion on an animal’s identifier. Finally, then total duration calculated using the <em>summarise()</em> and <em>sum()</em> functions.</p>
<pre class="r"><code>#Time in Selter System
#Included durations: period between intakes or returns until a movement or death; time in foster care until movement or death;
#Exclude durations: periods where an animal was adopted, reclaimed or stolen. Foster time 
tmp &lt;- interact %&gt;% 
          filter(!is.na(duration) &amp; 
                 !(interaction %in% c(&quot;Adoption&quot;, &quot;Reclaimed&quot;, &quot;Stolen&quot;,
                                      &quot;Escaped&quot;, &quot;Released to Wilderness&quot;))) %&gt;% 
          select(id,duration) %&gt;% 
          group_by(id) %&gt;% 
          summarise(timeinsys = sum(duration)) 
animals_s &lt;- join(animals_s,tmp,by=&quot;id&quot;)</code></pre>
</div>
<div id="adoption-foster-and-reclaimed-animal-flags-and-counts" class="section level4">
<h4>Adoption, Foster and Reclaimed Animal Flags and Counts</h4>
<p>The following processes calculate a number of fields related to common animal movements. First, a logic field is calculated to indicate if an animal was transfered out of the shelter, adopted, fostered, and or reclaimed by the animal’s owner. Next, the count of times an animal is adopted, fostered or reclaimed are calculated. These movement may appear multiple times in the shelter interaction log.</p>
<pre class="r"><code>#Flags animals by type of common movement
tmp &lt;- interact %&gt;% 
        filter(type==&quot;move&quot;) %&gt;%
        group_by(id) %&gt;%
        summarise(
          transferout = any(interaction==&quot;Transfer&quot;),
          adopt = any(interaction==&quot;Adoption&quot;),
          foster = any(interaction==&quot;Foster&quot;),
          reclaim = any(interaction==&quot;Reclaimed&quot;)
        ) 
#T/F to 1/0 
tmp[,2:5] &lt;- lapply(tmp[,2:5], as.numeric)
#Counts of common movements
tmp$reclaim_ct &lt;- tmp$foster_ct &lt;- tmp$adopt_ct &lt;-  0
#Number of time animal was Adopted
tmp2 &lt;- interact %&gt;% 
          filter(type==&quot;move&quot; &amp; interaction==&quot;Adoption&quot;) %&gt;%
          group_by(id) %&gt;%
          summarise(ct = n())
tmp[tmp$id %in% tmp2$id,]$adopt_ct &lt;- tmp2$ct
#Count of times animal fostered
tmp2 &lt;- interact %&gt;% 
          filter(type==&quot;move&quot; &amp; interaction==&quot;Foster&quot;) %&gt;%
          group_by(id) %&gt;%
          summarise(ct = n())
tmp[tmp$id %in% tmp2$id,]$foster_ct &lt;- tmp2$ct
#Count of times animal reclaimed
tmp2 &lt;- interact %&gt;% 
          filter(type==&quot;move&quot; &amp; interaction==&quot;Reclaimed&quot;) %&gt;%
          group_by(id) %&gt;%
          summarise(ct = n())
tmp[tmp$id %in% tmp2$id,]$reclaim_ct &lt;- tmp2$ct
#Joins tmp file to supplemental data frame
animals_s &lt;- join(animals_s,tmp,by=&quot;id&quot;)
#Re-order columns
animals_s &lt;- animals_s[,c(1:14,17,15,18,16,19)]
rm(tmp, tmp2)</code></pre>
</div>
<div id="return-flag-and-counts" class="section level4">
<h4>Return Flag and Counts</h4>
<p>The following processes calculates a number of fields animals returned to the system. First, a logic field is calculated to indicate that an animal returned to the shelter system. Next, the count of times an animal was returned is calculated, as an animal may return multiple times.</p>
<pre class="r"><code>#Flags animals by type of common movement
tmp &lt;- interact %&gt;% 
        filter(type==&quot;return&quot;) %&gt;%
        group_by(id) %&gt;%
        summarise(return=any(type==&quot;return&quot;),
                  return_ct=n())
#T/F to 1/0 
tmp[,2] &lt;- lapply(tmp[,2], as.numeric)
#Join fields to supplemental stat data frame
animals_s &lt;- join(animals_s,tmp,by=&quot;id&quot;)
#Updates NA fields to 0 values for animals that have not been returned
animals_s[is.na(animals_s$return),c(20:21)] &lt;- 0</code></pre>
</div>
<div id="transfer-into-shelter-flag" class="section level4">
<h4>Transfer Into Shelter Flag</h4>
<pre class="r"><code>tmp &lt;- interact %&gt;% 
        filter(type==&quot;intake&quot;) %&gt;%
        group_by(id) %&gt;%
        summarise(
          transferin = any(interaction==&quot;Transfer from Other Shelter&quot;),
        )
#T/F to 1/0 
tmp[,2] &lt;- lapply(tmp[,2], as.numeric)
#Join field to supplemental stats
animals_s &lt;- join(animals_s,tmp,by=&quot;id&quot;)
#Reorder fields
animals_s &lt;- animals_s[,c(1:12,22,13:21)]</code></pre>
</div>
<div id="death-logged-by-shelter-flag" class="section level4">
<h4>Death Logged by Shelter Flag</h4>
<pre class="r"><code>tmp &lt;- dead %&gt;% 
        group_by(id) %&gt;%
        summarise(
          dead = 1)
#Join field to supplemental stats
animals_s &lt;- join(animals_s,tmp,by=&quot;id&quot;)
#Reorder fields
animals_s[is.na(animals_s$dead),]$dead &lt;- 0</code></pre>
</div>
<div id="shelter-intake-date" class="section level4">
<h4>Shelter Intake Date</h4>
<pre class="r"><code>tmp &lt;- interact %&gt;% 
        group_by(id) %&gt;%
        summarise(intakedate = first(date))
# Add field to supplemental stats
animals_s &lt;- join(animals_s,tmp,by=&quot;id&quot;)
rm(tmp)</code></pre>
</div>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
